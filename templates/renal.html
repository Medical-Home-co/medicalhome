<style>
    .card-data-row { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; font-size: 0.95rem; }
    .card-data-row span:first-child { color: var(--text-secondary); }
    .card-data-row .data-value { font-weight: 600; color: var(--text-primary); }
    .card-data-row.dotted { border-bottom: 1px dotted var(--border-color); }
    .card-data-row.highlight .data-value { font-size: 1.2em; color: var(--primary-blue); }
    .liquid-log { margin-top: 1rem; max-height: 150px; overflow-y: auto; padding-right: 5px; }
    .liquid-log-entry { display: flex; justify-content: space-between; font-size: 0.9rem; color: var(--text-secondary); padding: 0.25rem 0; border-bottom: 1px solid var(--border-color); }
    .liquid-log-entry:last-child { border-bottom: none; }
    .summary-card.limit-exceeded { background-color: var(--danger-light, #FFEBEE) !important; border-color: var(--danger-color, #C62828) !important; }
    body.dark-theme .summary-card.limit-exceeded { background-color: var(--danger-light, #4b2222) !important; border-color: var(--danger-color, #ef9a9a) !important; }
    .summary-card.limit-exceeded *, body.dark-theme .summary-card.limit-exceeded * { color: var(--danger-color, #C62828) !important; }
    body.dark-theme .summary-card.limit-exceeded span, body.dark-theme .summary-card.limit-exceeded p { color: var(--danger-color, #ffcdd2) !important; }
    .bcm-separator { width: 100%; height: 1px; background-color: var(--border-color); margin: 1rem 0; }
    #bcm-history-container { display: grid; gap: 1.5rem; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); } /* Grid layout */
    .bcm-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem; }
    .bcm-card-actions { display: flex; gap: 0.5rem; flex-shrink: 0; }
</style>

<div class="page-container">
    <div class="page-header">
        <div>
            <h2 class="page-title">Balance Hídrico (BCM)</h2>
            <p class="page-subtitle">Historial de peso y control de líquidos.</p>
        </div>
        <button id="add-bcm-main-btn" class="button button-primary hidden">
            <span>+ Agregar Registro</span>
        </button>
    </div>

    
    <div id="bcm-history-container" class="content-grid hidden">
        
    </div>

    
    <div id="bcm-empty-state" class="empty-state-container" style="text-align: center; margin-top: 4rem;">
        <h2 class="modal-title">Registra tu Balance Hídrico</h2>
        <img src="images/renal.png" alt="Icono Renal" style="width: 128px; height: 128px; margin: 1.5rem auto;">
        <p class="modal-subtitle" style="max-width: 400px; margin: 0 auto 1.5rem;">Comienza ingresando tu peso para calcular y controlar tu ingesta de líquidos.</p>
        <button id="add-bcm-initial-btn" class="button button-primary">Ingresar Primer Registro</button>
    </div>
</div>


<div id="bcm-weight-modal" class="modal-overlay hidden">
    <div class="modal-content">
        <h2 id="bcm-weight-modal-title" class="modal-title">Registrar Peso</h2>
        <form id="bcm-weight-form" class="modal-form">
            <input type="hidden" id="bcm-record-id" name="id">
            <div class="form-group">
                <label for="bcm-record-date">Fecha del Registro *</label>
                <input type="date" id="bcm-record-date" name="date" class="form-input" required>
            </div>
            <div class="form-group"> <label for="bcm-current-weight">Peso Actual (kg) *</label> <input type="number" step="0.1" id="bcm-current-weight" name="currentWeight" class="form-input" placeholder="Ej: 74.5" required> </div>
            <div class="form-group"> <label for="bcm-dry-weight">Peso Seco (kg) *</label> <input type="number" step="0.1" id="bcm-dry-weight" name="dryWeight" class="form-input" placeholder="Ej: 71.0" required> </div>
            <div class="modal-actions" style="margin-top: 1.5rem; display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;"> <button type="submit" class="button button-primary" style="width: 100%;">Guardar</button> <button type="button" id="cancel-weight-btn" class="button button-secondary" style="width: 100%;">Cancelar</button> </div>
        </form>
    </div>
</div>


<div id="bcm-liquid-modal" class="modal-overlay hidden">
    <div class="modal-content">
        <h2 class="modal-title">Agregar Líquido Ingerido</h2>
        <form id="bcm-liquid-form" class="modal-form">
            <!-- CAMBIO CRÍTICO: Input oculto para que el JS sepa a qué tarjeta añadir el líquido -->
            <input type="hidden" id="bcm-liquid-target-id">
            
            <div class="form-group"> <label for="bcm-liquid-amount">Cantidad (ml) *</label> <input type="number" id="bcm-liquid-amount" name="amount" class="form-input" placeholder="Ej: 200" required> </div>
             <div class="modal-actions" style="margin-top: 1.5rem; display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;"> <button type="submit" class="button button-primary" style="width: 100%;">Agregar</button> <button type="button" id="cancel-liquid-btn" class="button button-secondary" style="width: 100%;">Cancelar</button> </div>
        </form>
    </div>
</div>
